/*!
Portal Live Editor - Complete Version
@Copyright(c) 2025 nohohonki
@license MIT
*/
(function(){"use strict";window.initPortalCustomizer=async function(t){function e(){const t=location.pathname,e=t.match(/\/k\/guest\/(\d+)\//);if(e)return e[1];const n=location.hash,o=n.match(/#\/space\/(\d+)/);return o?o[1]:null}function n(){const t=location.pathname;return null!==t.match(/\/k\/guest\/(\d+)\//)}function o(){const t=location.pathname,e=t.match(/\/k\/guest\/(\d+)\//);if(e)return`guest_${e[1]}`;const n=location.hash,o=n.match(/#\/space\/(\d+)/);return o?`space_${o[1]}`:"main"}function i(t,o=null){if(o===window.DYNAMIC_CONFIG_APP_ID){if(n()){const n=e();return`/k/guest/${n}/v1${t}`}return kintone.api.url("/k/v1"+t,!0)}const i=window.CURRENT_SPACE_ID;return i?`/k/guest/${i}/v1${t}`:kintone.api.url("/k/v1"+t,!0)}async function a(t=null){try{let e;e=t?await kintone.api(`/k/guest/${t}/v1/apps`,"GET",{}):await kintone.api(kintone.api.url("/k/v1/apps",!0),"GET",{});for(const n of e.apps){const e=n.spaceId||null;if((t&&e===t||!t&&!e)&&n.name&&n.name.includes("ãƒãƒ¼ã‚¿ãƒ«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º"))return console.log(`è¨­å®šç”¨ã‚¢ãƒ—ãƒªã‚’ç™ºè¦‹: ${n.name} (ID: ${n.appId}, é ˜åŸŸ: ${t?"ã‚¹ãƒšãƒ¼ã‚¹":"ãƒ¡ã‚¤ãƒ³"})`),n.appId}return null}catch(t){return console.error("è¨­å®šç”¨ã‚¢ãƒ—ãƒªã®æ¤œå‡ºã«å¤±æ•—:",t),null}}async function l(t,e="auto"){try{const a=window.DYNAMIC_CONFIG_APP_ID;let l;l="shared"===e?0:"personal"===e?kintone.getLoginUser().id:"shared"===window.currentEditMode?0:"personal"===window.currentEditMode?kintone.getLoginUser().id:0;const d=JSON.stringify(t);if(n()){const t=`ãƒ¦ãƒ¼ã‚¶ãƒ¼ID = ${l}`,e=await kintone.api(i("/records",a),"GET",{app:a,query:t});if(e.records.length>0){const t=e.records[0];await kintone.api(i("/record",a),"PUT",{app:a,id:t.ãƒ¬ã‚³ãƒ¼ãƒ‰ç•ªå·.value,record:{"ãƒ‡ãƒ¼ã‚¿":{value:d}}})}else await kintone.api(i("/record",a),"POST",{app:a,record:{"ãƒ¦ãƒ¼ã‚¶ãƒ¼ID":{value:l},"ãƒ‡ãƒ¼ã‚¿":{value:d}}})}else{const t=o(),e=`ãƒ¦ãƒ¼ã‚¶ãƒ¼ID = ${l} and ã‚¨ãƒªã‚¢åˆ¤å®š = "${t}"`,n=await kintone.api(i("/records",a),"GET",{app:a,query:e});if(n.records.length>0){const e=n.records[0];await kintone.api(i("/record",a),"PUT",{app:a,id:e.ãƒ¬ã‚³ãƒ¼ãƒ‰ç•ªå·.value,record:{"ãƒ‡ãƒ¼ã‚¿":{value:d},"ã‚¨ãƒªã‚¢åˆ¤å®š":{value:t}}})}else await kintone.api(i("/record",a),"POST",{app:a,record:{"ãƒ¦ãƒ¼ã‚¶ãƒ¼ID":{value:l},"ãƒ‡ãƒ¼ã‚¿":{value:d},"ã‚¨ãƒªã‚¢åˆ¤å®š":{value:t}}})}}catch(t){throw console.error("kintoneã‚¢ãƒ—ãƒªã¸ã®ä¿å­˜ã‚¨ãƒ©ãƒ¼:",t),t}}async function d(t="auto"){try{const e=window.DYNAMIC_CONFIG_APP_ID;let a;if(a="shared"===t?0:kintone.getLoginUser().id,n()){const n=`ãƒ¦ãƒ¼ã‚¶ãƒ¼ID = ${a}`,o=await kintone.api(i("/records",e),"GET",{app:e,query:n});if(o.records.length>0){const t=o.records[0],e=t["ãƒ‡ãƒ¼ã‚¿"].value;if(e)return 0!==a&&(window.hasMyPortal=!0,window.currentViewMode="personal"),JSON.parse(e)}if(("auto"===t||"personal"===t)&&0!==a){window.hasMyPortal=!1,window.currentViewMode="shared";const t="ãƒ¦ãƒ¼ã‚¶ãƒ¼ID = 0",n=await kintone.api(i("/records",e),"GET",{app:e,query:t});if(n.records.length>0){const t=n.records[0],e=t["ãƒ‡ãƒ¼ã‚¿"].value;if(e)return JSON.parse(e)}}}else{const n=o(),l=`ãƒ¦ãƒ¼ã‚¶ãƒ¼ID = ${a} and ã‚¨ãƒªã‚¢åˆ¤å®š = "${n}"`,d=await kintone.api(i("/records",e),"GET",{app:e,query:l});if(d.records.length>0){const t=d.records[0],e=t["ãƒ‡ãƒ¼ã‚¿"].value;if(e)return 0!==a&&(window.hasMyPortal=!0,window.currentViewMode="personal"),JSON.parse(e)}if(("auto"===t||"personal"===t)&&0!==a){window.hasMyPortal=!1,window.currentViewMode="shared";const t=`ãƒ¦ãƒ¼ã‚¶ãƒ¼ID = 0 and ã‚¨ãƒªã‚¢åˆ¤å®š = "${n}"`,o=await kintone.api(i("/records",e),"GET",{app:e,query:t});if(o.records.length>0){const t=o.records[0],e=t["ãƒ‡ãƒ¼ã‚¿"].value;if(e)return JSON.parse(e)}}}return null}catch(t){return console.log("kintoneã‚¢ãƒ—ãƒªã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ:",t),null}}function r(){const t=document.getElementById("portal-grid"),e=1980,n=Math.floor(e/40);window.generateGridCSS(n);const o=100/n;t.style.setProperty("--grid-column-width",o+"%"),t.style.setProperty("--actual-columns",n);const i=GridStack.init({cellHeight:40,cellWidth:40,margin:0,float:!0,disableDrag:!0,disableResize:!1,minWidth:1,minHeight:2,animate:!0,resizable:{handles:"ne, se, sw, nw"},maxRow:50,column:n});window.grid=i,window.editMode=!1,window.hasMyPortal=!1,window.currentViewMode="shared";const a=document.getElementById("portal-grid");a&&a.classList.remove("edit-mode"),i.on("resizestop",function(t,e){const n=e.gridstackNode,o=e.classList.contains("no-header-item");n.w<2&&i.update(e,{w:2});const a=o?1:2;n.h<a&&i.update(e,{h:a})}),s(i)}function s(t){document.getElementById("editToggle").addEventListener("click",async()=>{window.editMode?(await f(t),window.editMode=!1,m()):await c()}),document.getElementById("editCancel").addEventListener("click",async()=>{if(window.editMode){const e=await Swal.fire({title:"ç·¨é›†ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã‹ï¼Ÿ",text:"ç·¨é›†ã‚’ä¿å­˜ã›ãšã«ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ",icon:"warning",showCancelButton:!0,confirmButtonText:"ã¯ã„",cancelButtonText:"ã„ã„ãˆ"});e.isConfirmed&&(await y(t,window.currentEditMode),window.editMode=!1,m(),Swal.fire({icon:"success",title:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«å®Œäº†",text:"ç·¨é›†ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã€å…ƒã®çŠ¶æ…‹ã«æˆ»ã‚Šã¾ã—ãŸã€‚",timer:1500,timerProgressBar:!0,showConfirmButton:!1}))}}),document.getElementById("addWidget").addEventListener("click",()=>{C(t)}),document.getElementById("resetLayout").addEventListener("click",async()=>{const e=await Swal.fire({title:"ç¾åœ¨ã®ã‚¿ãƒ–ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ",text:"ç¾åœ¨ã®ã‚¿ãƒ–ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãŒå‰Šé™¤ã•ã‚Œã€å…ƒã«æˆ»ã™ã“ã¨ã¯ã§ããªããªã‚Šã¾ã™ã€‚",icon:"warning",showCancelButton:!0,confirmButtonText:"ã¯ã„",cancelButtonText:"ã„ã„ãˆ"});if(e.isConfirmed){t.removeAll(!1);const e=window.tabs.find(t=>t.id===window.activeTabId);e&&(e.layouts=[],e.widgets={}),Swal.fire({icon:"success",title:"ãƒªã‚»ãƒƒãƒˆå®Œäº†",text:"ç¾åœ¨ã®ã‚¿ãƒ–ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã—ãŸã€‚",timer:1500,timerProgressBar:!0,showConfirmButton:!1})}}),document.getElementById("deleteMyPortal").addEventListener("click",async()=>{await G()}),document.getElementById("portalToggle").addEventListener("click",async()=>{await w()}),document.getElementById("addTab").addEventListener("click",()=>{k()})}async function c(){const t=await Swal.fire({title:"ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠ",text:"ã©ã¡ã‚‰ã®ãƒãƒ¼ã‚¿ãƒ«ã‚’ç·¨é›†ã—ã¾ã™ã‹ï¼Ÿ",showCancelButton:!0,confirmButtonText:"å…±æœ‰ãƒãƒ¼ã‚¿ãƒ«",cancelButtonText:"ãƒã‚¤ãƒãƒ¼ã‚¿ãƒ«",reverseButtons:!0});t.isConfirmed?(window.currentEditMode="shared",await u("shared")):t.isDismissed&&t.dismiss===Swal.DismissReason.cancel&&(window.currentEditMode="personal",await u("personal"))}async function u(t){await y(window.grid,t),window.editMode=!0,m(),Swal.fire({icon:"success",title:`${"shared"===t?"å…±æœ‰":"ãƒã‚¤"}ãƒãƒ¼ã‚¿ãƒ«ç·¨é›†ãƒ¢ãƒ¼ãƒ‰`,text:"ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸã€‚",timer:1500,timerProgressBar:!0,showConfirmButton:!1})}function p(t){const e=document.getElementById("portal-grid");e&&(t?e.classList.add("show-grid"):e.classList.remove("show-grid"));const n=document.getElementById("portal-grid");n&&(t?n.classList.add("edit-mode"):n.classList.remove("edit-mode"))}async function w(){if(window.editMode)return;const t="shared"===window.currentViewMode?"personal":"shared";try{await y(window.grid,t),window.currentViewMode=t,g();const e="personal"===t?"ãƒã‚¤ãƒãƒ¼ã‚¿ãƒ«ã«åˆ‡æ›¿":"å…±æœ‰ãƒãƒ¼ã‚¿ãƒ«ã«åˆ‡æ›¿";Swal.fire({icon:"success",title:`${e}ã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸ`,timer:1500,showConfirmButton:!1})}catch(t){console.error("ãƒãƒ¼ã‚¿ãƒ«åˆ‡ã‚Šæ›¿ãˆã‚¨ãƒ©ãƒ¼:",t),Swal.fire({icon:"error",title:"åˆ‡ã‚Šæ›¿ãˆã‚¨ãƒ©ãƒ¼",text:"ãƒãƒ¼ã‚¿ãƒ«ã®åˆ‡ã‚Šæ›¿ãˆã«å¤±æ•—ã—ã¾ã—ãŸ"})}}function g(){const t=document.getElementById("portalToggle");t&&(window.hasMyPortal&&!window.editMode?(t.style.display="inline-block",t.textContent="shared"===window.currentViewMode?"ãƒã‚¤ãƒãƒ¼ã‚¿ãƒ«ã«åˆ‡æ›¿":"å…±æœ‰ãƒãƒ¼ã‚¿ãƒ«ã«åˆ‡æ›¿"):t.style.display="none")}function m(){const t=document.getElementById("editToggle"),e=document.getElementById("editCancel"),n=document.getElementById("addWidget"),o=document.getElementById("addTab"),i=document.getElementById("resetLayout"),a=document.getElementById("deleteMyPortal");document.getElementById("portal-grid");if(window.editMode){const l="shared"===window.currentEditMode?"å…±æœ‰ãƒãƒ¼ã‚¿ãƒ«ç·¨é›†ä¸­":"ãƒã‚¤ãƒãƒ¼ã‚¿ãƒ«ç·¨é›†ä¸­";t.textContent=`ç·¨é›†çµ‚äº† (${l})`,t.className="kintoneplugin-button-dialog-ok",e.style.display="inline-block",n.style.display="inline-block",o.style.display="inline-block",i.style.display="inline-block",a.style.display="inline-block",window.grid.enableMove(!0),window.grid.enableResize(!0),p(!0),document.querySelectorAll(".portal-tab").forEach(t=>{const e=t.querySelector(".portal-tab-actions");e&&(e.style.display="flex")}),g()}else t.textContent="ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡æ›¿",t.className="kintoneplugin-button-normal",e.style.display="none",n.style.display="none",o.style.display="none",i.style.display="none",a.style.display="none",window.currentEditMode=null,window.grid.enableMove(!1),window.grid.enableResize(!1),g(),p(!1),document.querySelectorAll(".portal-tab").forEach(t=>{const e=t.querySelector(".portal-tab-actions");e&&(e.style.display="none")})}async function f(t){try{window.activeTabId&&D();const t={};if(document.querySelectorAll(".portal-widget").forEach(e=>{const n=e.getAttribute("data-id"),o=e.getAttribute("data-type");if(n&&o)switch(t[n]={type:o,title:e.querySelector(".widget-title")?e.querySelector(".widget-title").textContent:"",customTitle:e.getAttribute("data-custom-title"),customColor:e.getAttribute("data-custom-color"),hasHeader:e.getAttribute("data-has-header"),fontSize:e.getAttribute("data-font-size"),textAlign:e.getAttribute("data-text-align"),textColor:e.getAttribute("data-text-color")},o){case"app-display":t[n].appId=e.getAttribute("data-app-id"),t[n].viewId=e.getAttribute("data-view-id");break;case"app-shortcuts":const i=e.getAttribute("data-shortcuts");i&&(t[n].shortcuts=JSON.parse(i));break;case"rich-text":const a=e.querySelector("#richtext_"+n);a&&(t[n].content=a.innerHTML);break;case"iframe":const l=e.querySelector("iframe");l&&(t[n].url=l.src)}}),window.activeTabId){const e=window.tabs.find(t=>t.id===window.activeTabId);e&&(e.widgets=t)}const e={tabs:window.tabs||[],activeTabId:window.activeTabId,updated:(new Date).toISOString()};await l(e),Swal.fire({icon:"success",title:"ä¿å­˜å®Œäº†",text:"ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãŒä¿å­˜ã•ã‚Œã¾ã—ãŸã€‚",timer:1500,timerProgressBar:!0,showConfirmButton:!1})}catch(t){console.error("ä¿å­˜ã‚¨ãƒ©ãƒ¼:",t),Swal.fire({icon:"error",title:"ä¿å­˜ã‚¨ãƒ©ãƒ¼",text:"ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚"})}}async function y(t=window.grid,e="auto"){try{const t=await d(e);if(t&&t.tabs)return window.tabs=t.tabs.map(t=>({id:t.id,name:t.name,backgroundColor:t.backgroundColor||"#555555",textColor:t.textColor||"#ffffff",layouts:t.layouts||[],widgets:t.widgets||t.widgetData||{}})),window.tabs.length>0&&(window.activeTabId=window.tabs[0].id),b(),void(window.activeTabId&&z(window.activeTabId));h()}catch(t){console.error("ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:",t),h()}}function h(){const t={id:"tab_"+Date.now(),name:"ãƒ¡ã‚¤ãƒ³ã‚¿ãƒ–",backgroundColor:"#555555",textColor:"#ffffff",layouts:[],widgets:{}};window.tabs=[t],window.activeTabId=t.id,b()}function b(){const t=document.getElementById("tabs-list");t.innerHTML="",window.tabs&&window.tabs.length>0&&window.tabs.forEach(e=>{const n=v(e);t.appendChild(n)})}function v(t){const e=document.createElement("div");e.className="portal-tab dynamic-colors",e.setAttribute("data-tab-id",t.id),e.style.setProperty("--tab-bg-color",t.backgroundColor),e.style.setProperty("--tab-text-color",t.textColor),t.id===window.activeTabId&&e.classList.add("active"),e.innerHTML=`\n        <span class="portal-tab-label" title="${t.name}">${t.name}</span>\n        <div class="portal-tab-actions">\n          <input type="color" class="portal-tab-color-btn" value="${t.backgroundColor}" title="èƒŒæ™¯è‰²ã‚’å¤‰æ›´">\n          <input type="color" class="portal-tab-color-btn text-color" value="${t.textColor}" title="æ–‡å­—è‰²ã‚’å¤‰æ›´">\n          <button class="portal-tab-delete" title="ã‚¿ãƒ–ã‚’å‰Šé™¤">âœ•</button>\n        </div>\n      `,e.addEventListener("click",e=>{e.target.matches(".portal-tab-color-btn, .portal-tab-delete")||_(t.id)});const n=e.querySelector(".portal-tab-label");n.addEventListener("dblclick",()=>{window.editMode&&x(t.id)});const o=e.querySelector(".portal-tab-color-btn:first-of-type");o.addEventListener("change",e=>{window.editMode&&$(t.id,"backgroundColor",e.target.value)});const i=e.querySelector(".portal-tab-color-btn:last-of-type");i.addEventListener("change",e=>{window.editMode&&$(t.id,"textColor",e.target.value)});const a=e.querySelector(".portal-tab-delete");a.addEventListener("click",e=>{e.stopPropagation(),window.editMode&&I(t.id)});const l=e.querySelector(".portal-tab-actions");return l&&(l.style.display=window.editMode?"flex":"none"),e}async function x(t){const e=window.tabs.find(e=>e.id===t);if(!e)return;const{value:n}=await Swal.fire({title:"ã‚¿ãƒ–åã‚’ç·¨é›†",input:"text",inputValue:e.name,inputPlaceholder:"ã‚¿ãƒ–åã‚’å…¥åŠ›...",showCancelButton:!0,confirmButtonText:"ä¿å­˜",cancelButtonText:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«",inputValidator:t=>{if(!t||""===t.trim())return"ã‚¿ãƒ–åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼"}});n&&(e.name=n.trim(),b())}function $(t,e,n){const o=window.tabs.find(e=>e.id===t);if(!o)return;o[e]=n;const i=document.querySelector(`.portal-tab[data-tab-id="${t}"]`);i&&("backgroundColor"===e?i.style.setProperty("--tab-bg-color",n):"textColor"===e&&i.style.setProperty("--tab-text-color",n))}async function I(t){if(window.tabs.length<=1)return void Swal.fire({icon:"warning",title:"å‰Šé™¤ã§ãã¾ã›ã‚“",text:"æœ€ä½1ã¤ã®ã‚¿ãƒ–ãŒå¿…è¦ã§ã™ã€‚"});const e=window.tabs.find(e=>e.id===t);if(!e)return;const n=await Swal.fire({title:`ã€Œ${e.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`,text:"ã“ã®ã‚¿ãƒ–ã¨ã‚¿ãƒ–å†…ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯å®Œå…¨ã«å‰Šé™¤ã•ã‚Œã€å…ƒã«æˆ»ã™ã“ã¨ã¯ã§ããªããªã‚Šã¾ã™ã€‚",icon:"warning",showCancelButton:!0,confirmButtonText:"ã¯ã„",cancelButtonText:"ã„ã„ãˆ"});n.isConfirmed&&(window.tabs=window.tabs.filter(e=>e.id!==t),window.activeTabId===t&&(window.activeTabId=window.tabs[0].id,z(window.activeTabId)),b(),Swal.fire({icon:"success",title:"å‰Šé™¤å®Œäº†",text:"ã‚¿ãƒ–ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚",timer:1500,timerProgressBar:!0,showConfirmButton:!1}))}async function k(){const{value:t}=await Swal.fire({title:"æ–°ã—ã„ã‚¿ãƒ–ã‚’è¿½åŠ ",input:"text",inputPlaceholder:"ã‚¿ãƒ–åã‚’å…¥åŠ›...",inputValue:`ã‚¿ãƒ–${window.tabs.length+1}`,showCancelButton:!0,confirmButtonText:"è¿½åŠ ",cancelButtonText:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«",inputValidator:t=>{if(!t||""===t.trim())return"ã‚¿ãƒ–åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼"}});if(t){const e={id:"tab_"+Date.now(),name:t.trim(),backgroundColor:"#555555",textColor:"#ffffff",layouts:[],widgets:{}};window.tabs.push(e),b(),_(e.id),Swal.fire({icon:"success",title:"ã‚¿ãƒ–è¿½åŠ å®Œäº†",text:`ã€Œ${e.name}ã€ãŒè¿½åŠ ã•ã‚Œã¾ã—ãŸã€‚`,timer:1500,timerProgressBar:!0,showConfirmButton:!1})}}async function C(t){const{value:e}=await Swal.fire({title:"ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’è¿½åŠ ",input:"select",inputOptions:{"app-shortcuts":"ã‚¢ãƒ—ãƒªã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ","app-display":"ã‚¢ãƒ—ãƒªè¡¨ç¤ºï¼ˆãƒ“ãƒ¥ãƒ¼ãƒ»ã‚°ãƒ©ãƒ•ï¼‰","rich-text":"ãƒªãƒƒãƒãƒ†ã‚­ã‚¹ãƒˆ",iframe:"å¤–éƒ¨ã‚µã‚¤ãƒˆåŸ‹ã‚è¾¼ã¿"},inputPlaceholder:"ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆç¨®é¡ã‚’é¸æŠ",showCancelButton:!0,confirmButtonText:"æ¬¡ã¸",cancelButtonText:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"});if(e){const{value:n}=await Swal.fire({title:"ãƒ˜ãƒƒãƒ€ãƒ¼ã®è¡¨ç¤º",input:"select",inputOptions:{true:"ãƒ˜ãƒƒãƒ€ãƒ¼ã‚ã‚Šï¼ˆã‚¿ã‚¤ãƒˆãƒ«è¡¨ç¤ºï¼‰",false:"ãƒ˜ãƒƒãƒ€ãƒ¼ãªã—ï¼ˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã¿ï¼‰"},inputValue:"true",showCancelButton:!0,confirmButtonText:"æ¬¡ã¸",cancelButtonText:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"});if(void 0!==n){let o=null,i=null,a="standard",l="left",d="white";if("true"===n){const{value:t}=await Swal.fire({title:"ãƒ˜ãƒƒãƒ€ãƒ¼è¨­å®š",html:`\n                <div id="headerEditSwal">\n                  <div style="text-align: left; margin-bottom: 15px;">\n                    <label for="widget-title" style="display: block; margin-bottom: 5px; font-weight: bold;">ã‚¿ã‚¤ãƒˆãƒ«:</label>\n                    <input id="widget-title" type="text" class="swal2-input" placeholder="ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›" style="margin: 0;">\n                  </div>\n\n                  ${E()}\n\n                  ${K("#4caf79")}\n                </div>\n              `,showCancelButton:!0,confirmButtonText:"è¿½åŠ ",cancelButtonText:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«",didOpen:()=>{const t=document.getElementById("copy-hex");t&&(t.onclick=(()=>{const e=document.getElementById("hex-code").textContent;window.copyToClipboard(e,t)})),window.updateColorPreview()},preConfirm:()=>{const t=document.getElementById("widget-title").value,e=document.getElementById("widget-color").value,n=B();return Y(e),{title:t.trim(),color:e,...n}}});if(!t)return;o=t.title,i=t.color,a=t.fontSize,l=t.textAlign,d=t.textColor}S(t,e,"true"===n,o,i,a,l,d)}}}function S(t,e,n=!0,o=null,i=null,a="standard",l="left",d="white"){const r="widget_"+Date.now();let s="";switch(e){case"app-display":s=q(r,n,o,i,a,l,d);break;case"rich-text":s=M(r,n,o,i,a,l,d);break;case"app-shortcuts":s=P(r,n,o,i,a,l,d);break;case"iframe":s=L(r,n,o,i,a,l,d);break;default:return void console.error("Unknown widget type:",e)}const c=t.getGridItems();let u=0;c.forEach(t=>{const e=t.gridstackNode;if(e&&void 0!==e.y&&void 0!==e.h){const t=e.y+e.h;t>u&&(u=t)}});const p=Math.floor(.4*t.getColumn());t.addWidget({x:0,y:u,w:p,h:n?6:5,content:s,id:r})}function E(t="standard",e="left",n="white",o="widget"){return`\n        <div style="text-align: left; margin-bottom: 15px;">\n          <label for="${o}-font-size" style="display: block; margin-bottom: 5px; font-weight: bold;">æ–‡å­—ã‚µã‚¤ã‚º:</label>\n          <select id="${o}-font-size" class="swal2-select" style="margin: 0;">\n            <option value="standard" ${"standard"===t?"selected":""}>æ¨™æº–</option>\n            <option value="large" ${"large"===t?"selected":""}>å¤§</option>\n            <option value="extra-large" ${"extra-large"===t?"selected":""}>ç‰¹å¤§</option>\n          </select>\n        </div>\n\n        <div style="text-align: left; margin-bottom: 15px;">\n          <label for="${o}-text-align" style="display: block; margin-bottom: 5px; font-weight: bold;">æ–‡å­—ä¸¦ã³:</label>\n          <select id="${o}-text-align" class="swal2-select" style="margin: 0;">\n            <option value="left" ${"left"===e?"selected":""}>å·¦</option>\n            <option value="center" ${"center"===e?"selected":""}>çœŸã‚“ä¸­</option>\n            <option value="right" ${"right"===e?"selected":""}>å³</option>\n          </select>\n        </div>\n\n        <div style="text-align: left; margin-bottom: 15px;">\n          <label for="${o}-text-color" style="display: block; margin-bottom: 5px; font-weight: bold;">æ–‡å­—è‰²:</label>\n          <select id="${o}-text-color" class="swal2-select" style="margin: 0;">\n            <option value="white" ${"white"===n?"selected":""}>ç™½</option>\n            <option value="black" ${"black"===n?"selected":""}>é»’</option>\n          </select>\n        </div>\n      `}function B(t="widget"){return{fontSize:document.getElementById(`${t}-font-size`).value,textAlign:document.getElementById(`${t}-text-align`).value,textColor:document.getElementById(`${t}-text-color`).value}}function T(t,e,n,o){const i="center"===e?"center":"right"===e?"flex-end":"space-between",a="large"===o?"20px":"extra-large"===o?"24px":"16px";return{headerStyle:`background: ${t} !important; justify-content: ${i};`,titleStyle:`color: ${n}; font-size: ${a};`}}function A(t,e,n,o,i,a,l,d){return`data-type="${e}" data-id="${t}" data-has-header="${n}" data-custom-title="${o}" data-custom-color="${i||""}" data-font-size="${a}" data-text-align="${l}" data-text-color="${d}"`}function q(t,e=!0,n=null,o=null,i="standard",a="left",l="white"){const d=e?"":"no-header",r=n||"ã‚¢ãƒ—ãƒªè¡¨ç¤º",s=o||"#4caf79",c=A(t,"app-display",e,r,o,i,a,l),{headerStyle:u,titleStyle:p}=T(s,a,l,i);return`\n        <div class="portal-widget ${d}" ${c}>\n          <div class="widget-header" style="${u}">\n            <span class="widget-title" style="${p}">${r}</span>\n            <button class="widget-edit-header" onclick="editWidgetHeader('${t}')">ãƒ˜ãƒƒãƒ€ãƒ¼ç·¨é›†</button>\n          </div>\n          <div class="widget-content" id="content_${t}">\n            <button class="widget-edit-btn" onclick="editAppDisplayWidget('${t}')">è¨­å®š</button>\n            <button class="widget-delete-btn" onclick="deleteWidget('${t}')"><span class="deleteText">âœ•</span></button>\n            <p>ã‚¢ãƒ—ãƒªã¨ãƒ“ãƒ¥ãƒ¼/ã‚°ãƒ©ãƒ•ã‚’é¸æŠã—ã¦ãã ã•ã„</p>\n          </div>\n        </div>\n      `}function M(t,e=!0,n=null,o=null,i="standard",a="left",l="white"){const d=e?"":"no-header",r=n||"ãƒªãƒƒãƒãƒ†ã‚­ã‚¹ãƒˆ",s=o||"#4caf79",c=A(t,"rich-text",e,r,o,i,a,l),{headerStyle:u,titleStyle:p}=T(s,a,l,i);return`\n        <div class="portal-widget ${d}" ${c}>\n          <div class="widget-header" style="${u}">\n            <span class="widget-title" style="${p}">${r}</span>\n            <button class="widget-edit-header" onclick="editWidgetHeader('${t}')">ãƒ˜ãƒƒãƒ€ãƒ¼ç·¨é›†</button>\n          </div>\n          <div class="widget-content" id="content_${t}">\n            <button class="widget-edit-btn" onclick="toggleRichTextEdit('${t}')">ç·¨é›†</button>\n            <button class="widget-delete-btn" onclick="deleteWidget('${t}')"><span class="deleteText">âœ•</span></button>\n            <div class="richtext-container" id="richtext-container_${t}">\n              <div id="richtext_${t}" class="richtext-content"></div>\n            </div>\n          </div>\n        </div>\n      `}function P(t,e=!0,n=null,o=null,i="standard",a="left",l="white"){const d=e?"":"no-header",r=n||"ã‚¢ãƒ—ãƒªã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ",s=o||"#4caf79",c=A(t,"app-shortcuts",e,r,o,i,a,l),{headerStyle:u,titleStyle:p}=T(s,a,l,i);return`\n        <div class="portal-widget ${d}" ${c}>\n          <div class="widget-header" style="${u}">\n            <span class="widget-title" style="${p}">${r}</span>\n            <button class="widget-edit-header" onclick="editWidgetHeader('${t}')">ãƒ˜ãƒƒãƒ€ãƒ¼ç·¨é›†</button>\n          </div>\n          <div class="widget-content" id="content_${t}">\n            <button class="widget-edit-btn" onclick="editAppShortcutsWidget('${t}')">è¨­å®š</button>\n            <button class="widget-delete-btn" onclick="deleteWidget('${t}')"><span class="deleteText">âœ•</span></button>\n            <p>ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’è¨­å®šã—ã¦ãã ã•ã„</p>\n          </div>\n        </div>\n      `}function L(t,e=!0,n=null,o=null,i="standard",a="left",l="white"){const d=e?"":"no-header",r=n||"å¤–éƒ¨ã‚µã‚¤ãƒˆ",s=o||"#4caf79",c=A(t,"iframe",e,r,o,i,a,l),{headerStyle:u,titleStyle:p}=T(s,a,l,i);return`\n        <div class="portal-widget ${d}" ${c}>\n          <div class="widget-header" style="${u}">\n            <span class="widget-title" style="${p}">${r}</span>\n            <button class="widget-edit-header" onclick="editWidgetHeader('${t}')">ãƒ˜ãƒƒãƒ€ãƒ¼ç·¨é›†</button>\n          </div>\n          <div class="widget-content" id="content_${t}">\n            <button class="widget-edit-btn" onclick="editIframeWidget('${t}')">è¨­å®š</button>\n            <button class="widget-delete-btn" onclick="deleteWidget('${t}')"><span class="deleteText">âœ•</span></button>\n            <p>URLã‚’è¨­å®šã—ã¦ãã ã•ã„</p>\n          </div>\n        </div>\n      `}function _(t){window.activeTabId&&window.grid&&window.activeTabId!==t&&D(),window.activeTabId=t,document.querySelectorAll(".portal-tab").forEach(t=>{t.classList.remove("active")});const e=document.querySelector(`.portal-tab[data-tab-id="${t}"]`);e&&e.classList.add("active"),z(t)}function D(){const t=window.tabs.find(t=>t.id===window.activeTabId);if(!t)return;const e=window.grid.save(),n=document.querySelectorAll(".portal-widget"),o={};n.forEach(t=>{const e=t.dataset.id;if(!e)return;const n={type:t.dataset.type,hasHeader:t.dataset.hasHeader,customTitle:t.dataset.customTitle,customColor:t.dataset.customColor,fontSize:t.dataset.fontSize,textAlign:t.dataset.textAlign,textColor:t.dataset.textColor};switch(t.dataset.type){case"app-display":n.appId=t.getAttribute("data-app-id"),n.viewId=t.getAttribute("data-view-id");break;case"rich-text":const o=t.querySelector("#richtext_"+e);o&&(n.content=o.innerHTML);break;case"app-shortcuts":const i=t.getAttribute("data-shortcuts");i&&(n.shortcuts=JSON.parse(i));break;case"iframe":const a=t.querySelector("iframe");a&&(n.url=a.src)}o[e]=n}),t.layouts=e,t.widgets=o,console.log("ç¾åœ¨ã®ã‚¿ãƒ–ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸ:",window.activeTabId,"ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿:",o)}function z(t){const e=window.tabs.find(e=>e.id===t);e&&window.grid&&(window.grid.removeAll(),e.layouts&&Array.isArray(e.layouts)&&e.layouts.length>0&&(window.grid.load(e.layouts),e.widgets&&Object.keys(e.widgets).length>0&&setTimeout(async()=>{await H(e.widgets)},500)))}async function H(t){for(const e in t){const n=t[e],o=document.querySelector(`[data-id="${e}"]`);if(o)try{switch(n.type){case"app-display":n.appId&&n.viewId&&(o.setAttribute("data-app-id",n.appId),o.setAttribute("data-view-id",n.viewId),et(e,n.appId,n.viewId));break;case"app-shortcuts":n.shortcuts&&(o.setAttribute("data-shortcuts",JSON.stringify(n.shortcuts)),await V(e,n.shortcuts));break;case"rich-text":if(n.content){const t=o.querySelector("#richtext_"+e);t&&(t.innerHTML=n.content)}break;case"iframe":n.url&&N(e,`\n                  <iframe src="${n.url}"\n                          width="100%"\n                          height="100%"\n                          frameborder="0"\n                          style="min-height: 200px;">\n                  </iframe>\n                `)}if(n.customTitle){const t=o.querySelector(".widget-title");t&&(t.textContent=n.customTitle),o.setAttribute("data-custom-title",n.customTitle)}else if(n.title){const t=o.querySelector(".widget-title");t&&(t.textContent=n.title)}if(n.customColor){const t=o.querySelector(".widget-header");t&&(t.style.background=n.customColor),o.setAttribute("data-custom-color",n.customColor)}const t=o.querySelector(".widget-header"),i=o.querySelector(".widget-title");if(n.fontSize&&(o.setAttribute("data-font-size",n.fontSize),i)){let t;switch(n.fontSize){case"large":t="20px";break;case"extra-large":t="24px";break;default:t="16px"}i.style.fontSize=t}n.textAlign&&t&&(o.setAttribute("data-text-align",n.textAlign),"center"===n.textAlign?t.style.justifyContent="center":"right"===n.textAlign?t.style.justifyContent="flex-end":t.style.justifyContent="space-between"),n.textColor&&i&&(o.setAttribute("data-text-color",n.textColor),i.style.color=n.textColor)}catch(t){console.error(`ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ${e}ã®å¾©å…ƒã‚¨ãƒ©ãƒ¼:`,t)}}}function N(t,e){const n=document.getElementById(`content_${t}`);if(!n)return;const o=n.querySelector(".widget-edit-btn"),i=n.querySelector(".widget-delete-btn");n.innerHTML=e,o&&n.insertBefore(o,n.firstChild),i&&n.insertBefore(i,n.firstChild)}async function O(){try{const t=location.pathname,i=location.hash,l=/\/k\/\d+\//.test(t);if(l)return void console.log("ã‚¢ãƒ—ãƒªç”»é¢ã®ãŸã‚ã€ãƒãƒ¼ã‚¿ãƒ«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚’ç„¡åŠ¹åŒ–");const d=t.includes("/k/")&&("#/portal"===i||""===i&&"/k/"===t||i.includes("#/space/"));if(!d)return void console.log("ãƒãƒ¼ã‚¿ãƒ«ç”»é¢ã§ã¯ãªã„ãŸã‚ã€ãƒãƒ¼ã‚¿ãƒ«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚’ç„¡åŠ¹åŒ–");const r=e(),s=o();console.log(`ç¾åœ¨ã®ç’°å¢ƒ - Space: ${r}, Area: ${s}, URL: ${location.href}`);const c=n()?r:null;console.log(`è¨­å®šç”¨ã‚¢ãƒ—ãƒªæ¤œç´¢å¯¾è±¡ - SearchSpace: ${c} (isGuest: ${n()})`);const u=await a(c);if(!u)return void console.log("è¨­å®šç”¨ã‚¢ãƒ—ãƒªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ãƒãƒ¼ã‚¿ãƒ«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã¯ç„¡åŠ¹ã§ã™ã€‚");window.DYNAMIC_CONFIG_APP_ID=u,window.CURRENT_SPACE_ID=r,await Promise.all([dt("https://cdn.jsdelivr.net/npm/gridstack@10.1.0/dist/gridstack-all.js"),dt("https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"),dt("https://cdn.jsdelivr.net/npm/sweetalert2@11"),dt("https://unpkg.com/quill@1.3.6/dist/quill.js"),dt("https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js")]),rt("https://cdn.jsdelivr.net/npm/gridstack@10.1.0/dist/gridstack.min.css"),rt("https://unpkg.com/quill@1.3.6/dist/quill.snow.css"),rt("https://nohohonki.github.io/portal-customization-plugin/portal-live-editor.min.css"),setTimeout(()=>{W()},500)}catch(t){console.error("ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:",t)}}function W(){const t=kintone.getLoginUser(),e=!lt.ADMIN_ONLY||t.isAdmin;let n=document.querySelector(".kintone-portal-content-space");if(n||(n=document.querySelector(".gaia-argoui-space-spacelayout-content-space")),!n)return void console.log("ãƒãƒ¼ã‚¿ãƒ«ç”»é¢ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼ˆãƒ¡ã‚¤ãƒ³é ˜åŸŸãƒ»ã‚²ã‚¹ãƒˆã‚¹ãƒšãƒ¼ã‚¹ã¨ã‚‚ã«æ¤œç´¢æ¸ˆã¿ï¼‰");const o=document.createElement("div");o.innerHTML=`\n        <div id="portal-customizer">\n          <div id="portal-toolbar">\n            <div id="tabs-container">\n              <div id="tabs-list">\n                <!-- ã‚¿ãƒ–ãŒã“ã“ã«å‹•çš„ã«è¿½åŠ ã•ã‚Œã¾ã™ -->\n              </div>\n              <button id="addTab" class="kintoneplugin-button-normal">\n                + ã‚¿ãƒ–è¿½åŠ \n              </button>\n            </div>\n            <div class="editButtonWrap">\n              <button id="portalToggle" class="kintoneplugin-button-normal" style="display: none;">\n                ãƒã‚¤ãƒãƒ¼ã‚¿ãƒ«\n              </button>\n              <button id="editToggle" class="kintoneplugin-button-normal" style="display: ${e?"inline-block":"none"};">\n                ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡æ›¿\n              </button>\n              <button id="editCancel" class="kintoneplugin-button-dialog-cancel">\n                ã‚­ãƒ£ãƒ³ã‚»ãƒ«\n              </button>\n              <button id="addWidget" class="kintoneplugin-button-normal">\n                ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆè¿½åŠ \n              </button>\n              <button id="resetLayout" class="kintoneplugin-button-dialog-cancel">\n                ç¾åœ¨ã®ã‚¿ãƒ–ã‚’ãƒªã‚»ãƒƒãƒˆ\n              </button>\n              <button id="deleteMyPortal" class="kintoneplugin-button-dialog-cancel">\n                è¨­å®šã‚’åˆæœŸåŒ–\n              </button>\n            </div>\n          </div>\n          <div class="grid-stack" id="portal-grid"></div>\n        </div>\n      `,n.insertBefore(o,n.firstChild),r(),y().then(()=>{g()})}async function G(){const t="personal"===window.currentEditMode?"personal":"shared",e="personal"===t?"å€‹äººãƒãƒ¼ã‚¿ãƒ«":"å…±æœ‰ãƒãƒ¼ã‚¿ãƒ«",a=await Swal.fire({title:`${e}ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`,text:`${e}ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¨ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒå®Œå…¨ã«å‰Šé™¤ã•ã‚Œã€å…ƒã«æˆ»ã™ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚`,icon:"warning",showCancelButton:!0,confirmButtonText:"ã¯ã„",cancelButtonText:"ã„ã„ãˆ"});if(a.isConfirmed)try{const a=window.DYNAMIC_CONFIG_APP_ID,l="personal"===t?kintone.getLoginUser().id:0;let d;if(n()){const t=`ãƒ¦ãƒ¼ã‚¶ãƒ¼ID = ${l}`;d=await kintone.api(i("/records",a),"GET",{app:a,query:t})}else{const t=o(),e=`ãƒ¦ãƒ¼ã‚¶ãƒ¼ID = ${l} and ã‚¨ãƒªã‚¢åˆ¤å®š = "${t}"`;d=await kintone.api(i("/records",a),"GET",{app:a,query:e})}if(d.records.length>0){const t=d.records[0].ãƒ¬ã‚³ãƒ¼ãƒ‰ç•ªå·.value;await kintone.api(i("/records",a),"DELETE",{app:a,ids:[t]})}window.grid.removeAll(!1),h(),window.editMode=!1,m(),Swal.fire({icon:"success",title:"å‰Šé™¤å®Œäº†",text:`${e}ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚`,timer:2e3,timerProgressBar:!0,showConfirmButton:!1})}catch(t){console.error("å‰Šé™¤ã‚¨ãƒ©ãƒ¼:",t),Swal.fire({icon:"error",title:"å‰Šé™¤ã‚¨ãƒ©ãƒ¼",text:`${e}ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚`})}}async function U(t){const e=document.querySelector(`[data-id="${t}"]`);if(!e)return;const n=e.getAttribute("data-custom-title")||e.querySelector(".widget-title").textContent,o=e.getAttribute("data-custom-color")||"#4caf79",i=e.getAttribute("data-font-size")||"standard",a=e.getAttribute("data-text-align")||"left",l=e.getAttribute("data-text-color")||"white",d=K(o).replace('id="widget-color"','id="edit-widget-color"').replace('for="widget-color"','for="edit-widget-color"').replace('id="hex-input"','id="edit-hex-input"').replace('for="hex-input"','for="edit-hex-input"'),{value:r}=await Swal.fire({title:"ãƒ˜ãƒƒãƒ€ãƒ¼ç·¨é›†",html:`\n          <div id="headerEditSwal">\n            <div style="text-align: left; margin-bottom: 15px;">\n              <label for="edit-widget-title" style="display: block; margin-bottom: 5px; font-weight: bold;">ã‚¿ã‚¤ãƒˆãƒ«:</label>\n              <input id="edit-widget-title" type="text" class="swal2-input" value="${n}" style="margin: 0;">\n            </div>\n\n            ${E(i,a,l,"edit")}\n\n            ${d}\n          </div>\n        `,showCancelButton:!0,confirmButtonText:"æ›´æ–°",cancelButtonText:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«",didOpen:()=>{const t=document.getElementById("copy-hex");t&&(t.onclick=(()=>{const e=document.getElementById("hex-code").textContent;window.copyToClipboard(e,t)})),window.selectHistoryColor=function(t){const e=document.getElementById("edit-widget-color");e&&(e.value=t,updateEditColorPreview())},window.updateEditColorPreview=function(){const t=document.getElementById("edit-widget-color"),e=document.getElementById("hex-code"),n=document.getElementById("edit-hex-input");if(t&&e){const o=t.value;e.textContent=o.toUpperCase(),n&&n.value!==o&&(n.value=o)}};const e=document.getElementById("edit-widget-color");e&&(e.onchange=window.updateEditColorPreview),window.updateEditColorPreview()},preConfirm:()=>{const t=document.getElementById("edit-widget-title").value,e=document.getElementById("edit-widget-color").value,n=B("edit");return Y(e),{title:t.trim(),color:e,...n}}});r&&j(t,r.title,r.color,r.fontSize,r.textAlign,r.textColor)}function j(t,e,n,o,i,a){const l=document.querySelector(`[data-id="${t}"]`);if(!l)return;l.setAttribute("data-custom-title",e),l.setAttribute("data-custom-color",n),o&&l.setAttribute("data-font-size",o),i&&l.setAttribute("data-text-align",i),a&&l.setAttribute("data-text-color",a);const d=l.querySelector(".widget-title");d&&(d.textContent=e);const r=l.querySelector(".widget-header");if(r){if(r.style.background=n,o){let t;switch(o){case"large":t="20px";break;case"extra-large":t="24px";break;default:t="16px"}d&&(d.style.fontSize=t)}i&&(r.style.justifyContent="center"===i?"center":"right"===i?"flex-end":"space-between"),a&&d&&(d.style.color=a)}}async function R(t){try{
const e=await tt(),n=e.map(t=>`<label style="display: block; margin: 5px 0;">\n            <input type="checkbox" value="${t.appId}" data-name="${t.name}" data-space-id="${t.spaceId||""}">\n            ${t.name} (ID: ${t.appId})\n          </label>`).join(""),{value:o}=await Swal.fire({title:"ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚¢ãƒ—ãƒªã‚’é¸æŠ",html:`\n            <div style="max-height: 300px; overflow-y: auto; text-align: left;">\n              ${n}\n            </div>\n          `,showCancelButton:!0,preConfirm:()=>{const t=document.querySelectorAll('input[type="checkbox"]:checked');return Array.from(t).map(t=>({appId:t.value,name:t.getAttribute("data-name"),spaceId:t.getAttribute("data-space-id")||null}))}});o&&o.length>0&&await V(t,o)}catch(t){console.error("ã‚¢ãƒ—ãƒªä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:",t)}}async function V(t,e){let n=e.map(t=>({...t,iconUrl:null}));try{const t=e.map(t=>"string"==typeof t.appId?parseInt(t.appId):t.appId),o=await kintone.app.getIcons(t);n=e.map(t=>{const e="string"==typeof t.appId?parseInt(t.appId):t.appId,n=o.find(t=>String(t.app)===String(e));return{...t,iconUrl:n.url||null}})}catch(t){console.error("ã‚¢ãƒ—ãƒªã‚¢ã‚¤ã‚³ãƒ³ã®å–å¾—ã«å¤±æ•—:",t)}const o=n.map(t=>{const e=t.iconUrl?`<img src="${t.iconUrl}" alt="${t.name}" class="app-icon" />`:`<div class="app-icon-placeholder">${t.name.charAt(0)}</div>`,n=t.spaceId||(st[t.appId]?st[t.appId].spaceId:null),o=X(t.appId,"","",n);return`<a href="${o}" class="app-shortcut-btn" target="_blank">\n          ${e}\n          <span class="app-name">${t.name}</span>\n        </a>`}).join("");N(t,`\n        <div class="app-shortcuts-container">\n          ${o}\n        </div>\n      `);const i=document.querySelector(`[data-id="${t}"]`);i.setAttribute("data-shortcuts",JSON.stringify(n)),window.activeTabId&&window.editMode&&D()}async function J(t){const{value:e}=await Swal.fire({title:"å¤–éƒ¨ã‚µã‚¤ãƒˆURL",input:"url",inputPlaceholder:"https://example.com",showCancelButton:!0,inputValidator:t=>t?t.startsWith("http")?void 0:"æœ‰åŠ¹ãªURLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„":"URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"});e&&(N(t,`\n          <iframe src="${e}"\n                  width="100%"\n                  height="100%"\n                  frameborder="0"\n                  style="min-height: 200px;">\n          </iframe>\n        `),window.activeTabId&&D())}function F(){const t=localStorage.getItem("widget_color_history");return t?JSON.parse(t):[]}function Y(t){let e=F();return e=e.filter(e=>e!==t),e.unshift(t),e.length>5&&(e=e.slice(0,5)),localStorage.setItem("widget_color_history",JSON.stringify(e)),e}function Q(t){return t?(t=t.replace("#",""),3===t.length&&(t=t.split("").map(t=>t+t).join("")),6===t.length&&/^[a-f0-9]{6}$/i.test(t)?"#"+t.toLowerCase():null):null}function K(t,e){const n=F();return`\n        <div style="text-align: left;">\n          <label for="widget-color" style="display: block; margin-bottom: 5px; font-weight: bold;">èƒŒæ™¯è‰²:</label>\n          <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">\n            <input id="widget-color" type="color" value="${t}"\n                   style="width: 60px; height: 40px; border: none; border-radius: 4px; cursor: pointer;"\n                   onchange="updateColorPreview()">\n            <div id="color-preview" style="flex: 1; padding: 8px; background: white; border: 1px solid #ddd; border-radius: 4px; font-family: monospace; font-size: 12px;">\n              <div id="hex-code">${t.toUpperCase()}</div>\n            </div>\n            <button type="button" id="copy-hex" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; background: white; cursor: pointer; font-size: 11px;">\n              HTMLã‚³ãƒ”ãƒ¼\n            </button>\n          </div>\n          <div style="margin-bottom: 10px;">\n            <label for="hex-input" style="display: block; margin-bottom: 5px; font-weight: bold; font-size: 12px;">HTMLã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰å…¥åŠ›:</label>\n            <div style="display: flex; align-items: center; gap: 8px;">\n              <input id="hex-input" type="text" value="${t}" placeholder="#4CAF79 ã¾ãŸã¯ 4CAF79"\n                     style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace; font-size: 12px;"\n                     oninput="validateAndApplyHexInput()"\n                     onpaste="setTimeout(validateAndApplyHexInput, 10)">\n              <button type="button" id="apply-hex" onclick="applyHexInput()"\n                      style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; background: #7066E0; color: white; cursor: pointer; font-size: 11px;">\n                é©ç”¨\n              </button>\n            </div>\n            <div id="hex-input-error" style="color: #d32f2f; font-size: 11px; margin-top: 4px; display: none;"></div>\n          </div>\n          ${n.length>0?`\n            <div style="margin-bottom: 10px;">\n              <label style="display: block; margin-bottom: 5px; font-weight: bold; font-size: 12px;">æœ€è¿‘ä½¿ç”¨ã—ãŸè‰²:</label>\n              <div style="display: flex; gap: 5px; flex-wrap: wrap;">\n                ${n.map(t=>`\n                  <div class="color-history-item"\n                       data-color="${t}"\n                       style="width: 24px; height: 24px; background: ${t}; border: 2px solid #ddd; border-radius: 4px; cursor: pointer; transition: all 0.2s;"\n                       onclick="selectHistoryColor('${t}')"\n                       title="${t}">\n                  </div>\n                `).join("")}\n              </div>\n            </div>\n          `:""}\n        </div>\n      `}function X(t,e="",o="",i=null){return console.log(`generateAppUrl: appId=${t}, spaceId=${i}, isGuestSpace=${n()}, currentURL=${location.href}`),i&&n()?(console.log("URLç”Ÿæˆ: ã‚²ã‚¹ãƒˆã‚¹ãƒšãƒ¼ã‚¹å½¢å¼ã‚’ä½¿ç”¨"),e?`/k/guest/${i}/${t}/${e}${o}`:`/k/guest/${i}/${t}${o}`):(console.log("URLç”Ÿæˆ: é€šå¸¸å½¢å¼ã‚’ä½¿ç”¨"),e?`/k/${t}/${e}${o}`:`/k/${t}${o}`)}function Z(t,e=null){const n=e&&st[e]?st[e].spaceId:null;return n?`/k/guest/${n}/v1${t}`:kintone.api.url(`/k/v1${t}`,!0)}async function tt(){console.log("ğŸ”¥ getAppsWithSpaceInfo é–¢æ•°ãŒå‘¼ã°ã‚Œã¾ã—ãŸ");try{const t=e();let o;if(console.log(`getAppsWithSpaceInfo - actualSpace: ${t}, isGuest: ${n()}`),console.log("ğŸ”¥ æ¡ä»¶åˆ†å²ã®å‰ã«åˆ°é”"),n())console.log("æ¡ä»¶åˆ†å²: ã‚²ã‚¹ãƒˆã‚¹ãƒšãƒ¼ã‚¹ãƒ‘ã‚¹ã‚’å®Ÿè¡Œ"),o=await kintone.api(`/k/guest/${t}/v1/apps`,"GET",{});else if(t){console.log("æ¡ä»¶åˆ†å²: é€šå¸¸ã‚¹ãƒšãƒ¼ã‚¹ãƒ‘ã‚¹ã‚’å®Ÿè¡Œ");try{console.log(`Space APIã§ã‚¹ãƒšãƒ¼ã‚¹å†…ã‚¢ãƒ—ãƒªå–å¾—: ã‚¹ãƒšãƒ¼ã‚¹ID ${t}`);const e=await kintone.api("/k/v1/space.json","GET",{id:t,includeApps:!0});console.log(`Space APIæˆåŠŸ: ${e.attachedApps.length}ä»¶ã®ã‚¢ãƒ—ãƒªã‚’å–å¾—`),console.log("å–å¾—ã—ãŸã‚¹ãƒšãƒ¼ã‚¹å†…ã‚¢ãƒ—ãƒª:",e.attachedApps.map(t=>({id:t.appId,name:t.name}))),o={apps:e.attachedApps}}catch(t){console.error("Space APIã§ã®ã‚¢ãƒ—ãƒªä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:",t),o={apps:[]}}}else console.log("æ¡ä»¶åˆ†å²: ãƒ¡ã‚¤ãƒ³é ˜åŸŸãƒ‘ã‚¹ã‚’å®Ÿè¡Œ"),o=await kintone.api(kintone.api.url("/k/v1/apps",!0),"GET",{}),o.apps=o.apps.filter(t=>!t.spaceId);return o.apps.forEach(t=>{st[t.appId]={name:t.name,spaceId:t.spaceId||null}}),console.log(`getAppsWithSpaceInfo - å–å¾—ã—ãŸã‚¢ãƒ—ãƒªæ•°: ${o.apps.length}`,o.apps.map(t=>({id:t.appId,name:t.name,spaceId:t.spaceId}))),o.apps}catch(t){return console.error("ã‚¢ãƒ—ãƒªä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:",t),[]}}function et(t,e,n,o=!1){const i=st[e]?st[e].spaceId:window.CURRENT_SPACE_ID;let a;a=o?X(e,"report",`?report=${n}`,i):X(e,"",n?`?view=${n}`:"",i);const l=`\n        <iframe src="${a}"\n                width="100%"\n                height="100%"\n                frameborder="0"\n                style="min-height: 300px;">\n        </iframe>\n      `;N(t,l);const d=document.querySelector(`[data-id="${t}"]`);d.setAttribute("data-app-id",e),d.setAttribute("data-view-id",n),d.setAttribute("data-is-report",o.toString()),window.activeTabId&&window.editMode&&D()}function N(t,e){const n=document.querySelector(`[data-id="${t}"]`);if(!n)return;const o=n.querySelector(".widget-content");if(!o)return;const i=o.querySelector(".widget-edit-btn"),a=o.querySelector(".widget-delete-btn");o.innerHTML=e,i&&o.insertBefore(i,o.firstChild),a&&o.insertBefore(a,o.firstChild)}async function nt(t,e){try{const n=await tt(),o={};n.forEach(t=>{o[t.appId]=`${t.name} (ID: ${t.appId})`});const{value:i}=await Swal.fire({title:"ã‚¢ãƒ—ãƒªã‚’é¸æŠ",input:"select",inputOptions:o,inputPlaceholder:"ã‚¢ãƒ—ãƒªã‚’é¸æŠã—ã¦ãã ã•ã„",showCancelButton:!0});i&&("app-view"===e?await showViewSelectionDialog(t,i):"app-display"===e&&await ot(t,i))}catch(t){console.error("ã‚¢ãƒ—ãƒªä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:",t)}}async function ot(t,e){try{const[n,o]=await Promise.allSettled([kintone.api(Z("/app/views",e),"GET",{app:e}),kintone.api(Z("/app/reports",e),"GET",{app:e})]);console.log("ãƒ“ãƒ¥ãƒ¼APIçµæœ:",n),console.log("ãƒ¬ãƒãƒ¼ãƒˆAPIçµæœ:",o);const i={all:"[ãƒ“ãƒ¥ãƒ¼] ã™ã¹ã¦"};if("fulfilled"===n.status){const t=n.value.views;Object.keys(t).forEach(e=>{const n=t[e];console.log(`ãƒ“ãƒ¥ãƒ¼ã‚­ãƒ¼: ${e}, ã‚¿ã‚¤ãƒ—: ${n.type}, åå‰: ${n.name}`);let o="[ãƒ“ãƒ¥ãƒ¼]";"CHART"===n.type?o="[ã‚°ãƒ©ãƒ•]":"PIVOT"===n.type&&(o="[ã‚¯ãƒ­ã‚¹é›†è¨ˆè¡¨]"),i[e]=`${o} ${n.name}`})}if("fulfilled"===o.status){const t=o.value.reports;console.log("å–å¾—ã—ãŸãƒ¬ãƒãƒ¼ãƒˆ:",t),Object.keys(t).forEach(e=>{const n=t[e];console.log(`ãƒ¬ãƒãƒ¼ãƒˆã‚­ãƒ¼: ${e}, åå‰: ${n.name}, ID: ${n.id}`),i[`report_${e}`]=`[ãƒ¬ãƒãƒ¼ãƒˆ] ${n.name}`})}console.log("æœ€çµ‚é¸æŠè‚¢:",i);const{value:a}=await Swal.fire({title:"ãƒ“ãƒ¥ãƒ¼ãƒ»ã‚°ãƒ©ãƒ•ã‚’é¸æŠ",input:"select",inputOptions:i,inputPlaceholder:"ãƒ“ãƒ¥ãƒ¼ã¾ãŸã¯ã‚°ãƒ©ãƒ•ã‚’é¸æŠã—ã¦ãã ã•ã„",showCancelButton:!0});if(a){let i,l=!1;if(a.startsWith("report_")){const t=a.replace("report_",""),e=o.value.reports[t];i=e.id,l=!0,console.log(`é¸æŠã•ã‚ŒãŸãƒ¬ãƒãƒ¼ãƒˆ: ${t}, ID: ${i}`)}else if("all"===a)i=null,console.log("é¸æŠã•ã‚ŒãŸãƒ“ãƒ¥ãƒ¼: ã™ã¹ã¦");else{const t=n.value.views[a];i=t.id,console.log(`é¸æŠã•ã‚ŒãŸãƒ“ãƒ¥ãƒ¼: ${a}, ID: ${i}`)}et(t,e,i,l)}}catch(t){console.error("ãƒ“ãƒ¥ãƒ¼ãƒ»ãƒ¬ãƒãƒ¼ãƒˆä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼:",t)}}function it(t){const e=document.getElementById(`richtext-container_${t}`),n=document.getElementById(`richtext_${t}`),o=document.querySelector(`[data-id="${t}"] .widget-edit-btn`);if(!e||!n||!o)return;const i=document.getElementById(`editor_${t}`);i&&i.remove();const a=e.querySelectorAll(".ql-toolbar");a.forEach(t=>t.remove());const l=n.innerHTML;e.classList.add("editing"),o.textContent="ä¿å­˜",n.style.display="none";const d=document.createElement("div");d.id=`editor_${t}`,e.appendChild(d),window.quillInstances||(window.quillInstances={});const r=[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{align:[]}],["clean"],["link","image"]],s=new Quill(`#editor_${t}`,{theme:"snow",modules:{toolbar:r},placeholder:"ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."});s.root.innerHTML=l,window.quillInstances[t]=s,setTimeout(()=>{s&&s.focus&&s.focus()},100)}function at(t){const e=document.getElementById(`richtext-container_${t}`),n=document.getElementById(`richtext_${t}`),o=document.querySelector(`[data-id="${t}"] .widget-edit-btn`),i=document.getElementById(`editor_${t}`);if(!e||!n||!o)return;if(window.quillInstances&&window.quillInstances[t]){const e=window.quillInstances[t],o=e.root.innerHTML;n.innerHTML=o,delete window.quillInstances[t]}i&&i.remove();const a=e.querySelectorAll(".ql-toolbar");a.forEach(t=>t.remove()),e.classList.remove("editing"),o.textContent="ç·¨é›†",n.style.display="block",window.activeTabId&&window.editMode&&D()}const lt=t||{ADMIN_ONLY:!1},dt=t=>new Promise((e,n)=>{const o=document.createElement("script");o.src=t,o.onload=e,o.onerror=n,document.head.appendChild(o)}),rt=t=>{const e=document.createElement("link");e.rel="stylesheet",e.href=t,document.head.appendChild(e)};window.generateGridCSS=function(t){const e=100/t,n=`\n        .grid-stack.gs-${t} > .grid-stack-item {\n          width: ${e}%;\n        }\n        `+Array.from({length:t-1},(n,o)=>{const i=o+1;return`\n          .grid-stack.gs-${t} > .grid-stack-item[gs-x='${i}'] { left: ${e*i}%; }\n          .grid-stack.gs-${t} > .grid-stack-item[gs-w='${i+1}'] { width: ${e*(i+1)}%; }\n          `}).join(""),o=document.createElement("style");o.textContent=n,document.head.appendChild(o)},window.deleteWidget=function(t){window.editMode&&Swal.fire({title:"ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ",text:"ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒå‰Šé™¤ã•ã‚Œã€å…ƒã«ã¯æˆ»ã›ãªããªã‚Šã¾ã™ã€‚",icon:"warning",showCancelButton:!0,confirmButtonText:"ã¯ã„",cancelButtonText:"ã„ã„ãˆ"}).then(e=>{if(e.isConfirmed){const e=document.querySelector(`[gs-id="${t}"]`);e&&window.grid.removeWidget(e),Swal.fire({title:"å‰Šé™¤å®Œäº†",text:"ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚",icon:"success",timer:1500,showConfirmButton:!1})}})},window.editWidgetHeader=function(t){window.editMode&&U(t)},window.editAppDisplayWidget=function(t){nt(t,"app-display")},window.toggleRichTextEdit=function(t){if(!window.editMode)return;const e=document.getElementById(`richtext-container_${t}`),n=document.getElementById(`richtext_${t}`),o=document.querySelector(`[data-id="${t}"] .widget-edit-btn`);if(!e||!n||!o)return;const i=e.classList.contains("editing");i?at(t):it(t)},window.editAppShortcutsWidget=async function(t){await R(t)},window.editIframeWidget=function(t){J(t)},window.updateColorPreview=function(){const t=document.getElementById("widget-color"),e=document.getElementById("hex-code"),n=document.getElementById("hex-input");if(t&&e){const o=t.value;e.textContent=o.toUpperCase(),n&&n.value!==o&&(n.value=o)}},window.selectHistoryColor=function(t){const e=document.getElementById("widget-color");e&&(e.value=t,window.updateColorPreview())},window.copyToClipboard=function(t,e){navigator.clipboard.writeText(t).then(()=>{const t=e.textContent;e.textContent="ã‚³ãƒ”ãƒ¼æ¸ˆã¿!",e.style.background="#505351",e.style.color="white",setTimeout(()=>{e.textContent=t,e.style.background="white",e.style.color="black"},1e3)}).catch(()=>{const n=document.createElement("textarea");n.value=t,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n);const o=e.textContent;e.textContent="ã‚³ãƒ”ãƒ¼æ¸ˆã¿!",e.style.background="#505351",e.style.color="white",setTimeout(()=>{e.textContent=o,e.style.background="white",e.style.color="black"},1e3)})},window.validateAndApplyHexInput=function(){const t=document.getElementById("hex-input"),e=document.getElementById("hex-input-error"),n=document.getElementById("apply-hex");if(!t||!e||!n)return;const o=t.value.trim();if(!o)return e.style.display="none",void(n.disabled=!1);const i=Q(o);i?(e.style.display="none",n.disabled=!1,t.style.borderColor="#ddd",applyHexInput()):(e.textContent="ç„¡åŠ¹ãªã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã§ã™ï¼ˆä¾‹: #4CAF79, 4CAF79, #fffï¼‰",e.style.display="block",n.disabled=!0,t.style.borderColor="#d32f2f")},window.applyHexInput=function(){const t=document.getElementById("hex-input")||document.getElementById("edit-hex-input"),e=document.getElementById("widget-color")||document.getElementById("edit-widget-color");if(!t||!e)return;const n=t.value.trim(),o=Q(n);o&&(e.value=o,t.value=o,document.getElementById("widget-color")&&window.updateColorPreview&&window.updateColorPreview(),document.getElementById("edit-widget-color")&&window.updateEditColorPreview&&window.updateEditColorPreview())};let st={};O()},"function"==typeof window.initPortalCustomizer||"undefined"!=typeof kintone&&kintone.events.on(["portal.show","space.portal.show"],async()=>{await window.initPortalCustomizer()})})();